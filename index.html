<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Toast Gaming - Community Projects</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e1e2f, #3a3a5d);
            color: white;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        h1 {
            font-size: 3rem;
            font-weight: 600;
            background: -webkit-linear-gradient(left, #ff6a00, #ee0979);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 10px;
        }

        input[type="url"] {
            width: 100%;
            max-width: 600px;
            padding: 12px;
            font-size: 1rem;
            border: 2px solid #ff6a00;
            border-radius: 8px;
            outline: none;
            transition: all 0.3s ease;
        }

        input[type="url"]:focus {
            border-color: #ee0979;
            box-shadow: 0 0 12px rgba(255, 106, 0, 0.5);
        }

        button {
            background: linear-gradient(90deg, #ff6a00, #ee0979);
            color: white;
            font-size: 1rem;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(238, 9, 121, 0.6);
        }

        #errorMessage {
            color: #ff4d4d;
            margin-top: 8px;
        }

        #projectsContainer {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .project-card {
            background-color: #2e2e4d;
            border-radius: 12px;
            padding: 15px;
            width: 240px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
        }

        .project-thumbnail {
            width: 100%;
            height: 140px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
        }

        .play-button {
            background-color: #00c853;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            color: white;
            cursor: pointer;
            margin-top: 10px;
        }

        .play-button:hover {
            background-color: #00a744;
        }

        iframe {
            margin-top: 20px;
            border: none;
            border-radius: 12px;
        }

        @media (max-width: 768px) {
            input[type="url"] {
                width: 90%;
            }

            .project-card {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <h1>Toast Gaming - Community Projects</h1>
    <h3>Submit your TurboWarp project URL (in format: https://turbowarp.org/PROJECT_ID/embed):</h3>

    <input type="url" id="projectUrl" placeholder="https://turbowarp.org/PROJECT_ID/embed">
    <button onclick="submitProject()">Submit Project</button>
    <div id="errorMessage"></div>

    <div id="projectsContainer"></div>

    <iframe id="playerFrame" width="480" height="360" style="display:none;"></iframe>

    <script>
        const VARIABLE_NAME = "☁ Projects";
        const cloudSocket = new WebSocket("wss://clouddata.turbowarp.org/");
        let currentProjects = [];

        cloudSocket.onopen = () => {
            cloudSocket.send(JSON.stringify({ m: "sub", project_id: "1134768903" }));
        };

        cloudSocket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.name === VARIABLE_NAME) {
                const decodedJson = cloudValueToString(data.value);
                try {
                    currentProjects = JSON.parse(decodedJson) || [];
                    renderProjects();
                } catch (e) {
                    console.error("Failed to parse cloud data:", e);
                    currentProjects = [];
                }
            }
        };

        function submitProject() {
            const urlInput = document.getElementById("projectUrl");
            const url = urlInput.value.trim();
            const match = url.match(/^https:\/\/turbowarp\.org\/(\d+)\/embed$/);

            if (!match) {
                document.getElementById("errorMessage").textContent = "Invalid URL. Must be like: https://turbowarp.org/PROJECT_ID/embed";
                return;
            }

            const projectId = match[1];

            currentProjects.push({ id: projectId });

            const jsonString = JSON.stringify(currentProjects);
            const encodedValue = stringToCloudValue(jsonString);

            cloudSocket.send(JSON.stringify({
                m: "set",
                project_id: "1134768903",
                name: VARIABLE_NAME,
                value: encodedValue
            }));

            urlInput.value = "";
            document.getElementById("errorMessage").textContent = "";
            renderProjects();
        }

        function renderProjects() {
            const container = document.getElementById("projectsContainer");
            container.innerHTML = "";

            currentProjects.forEach((project) => {
                const card = document.createElement("div");
                card.className = "project-card";

                const thumbnail = document.createElement("div");
                thumbnail.className = "project-thumbnail";
                thumbnail.style.backgroundImage = `url(https://uploads.scratch.mit.edu/get_image/project/${project.id}_480x360.png)`;

                const playButton = document.createElement("div");
                playButton.className = "play-button";
                playButton.textContent = "Play";
                playButton.onclick = () => playProject(project.id);

                card.appendChild(thumbnail);
                card.appendChild(playButton);
                container.appendChild(card);
            });
        }

        function playProject(projectId) {
            const playerFrame = document.getElementById("playerFrame");
            playerFrame.src = `https://turbowarp.org/${projectId}/embed`;
            playerFrame.style.display = "block";
        }

        function stringToCloudValue(str) {
            return Array.from(str).map(char => char.charCodeAt(0)).join(" ");
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Toast Gaming - Community Projects</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1e1e2f, #3a3a5d);
            color: white;
            text-align: center;
            padding: 20px;
        }

        h1 {
            background: linear-gradient(to right, #ff6a00, #ee0979);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 3rem;
        }

        input[type="url"] {
            width: 80%;
            max-width: 500px;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #ff6a00;
            background-color: #2e2e4d;
            color: white;
        }

        button {
            margin-top: 10px;
            background: linear-gradient(to right, #ff6a00, #ee0979);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        #errorMessage {
            color: #ff4d4d;
        }

        #projectsContainer {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .project-card {
            background-color: #2e2e4d;
            border-radius: 12px;
            padding: 10px;
            width: 220px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease;
        }

        .project-card:hover {
            transform: translateY(-5px);
        }

        .project-thumbnail {
            width: 100%;
            height: 140px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
        }

        .play-button {
            background-color: #00c853;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            color: white;
            margin-top: 10px;
            cursor: pointer;
        }

        .play-button:hover {
            background-color: #00a744;
        }

        #playerFrame {
            margin-top: 20px;
            border-radius: 12px;
            border: none;
            display: none;
        }

        #loadingBarContainer {
            margin-top: 10px;
            width: 300px;
            background-color: #ddd;
            height: 12px;
            border-radius: 6px;
            display: none;
            overflow: hidden;
        }

        #loadingBar {
            height: 12px;
            width: 0%;
            background-color: #ff6a00;
            transition: width 0.2s ease;
        }
    </style>
</head>

<body>
    <h1>Toast Gaming - Community Projects</h1>
    <p>Submit a TurboWarp project URL (e.g., https://turbowarp.org/PROJECT_ID/embed):</p>
    <input type="url" id="projectUrl" placeholder="Enter TurboWarp embed URL">
    <button onclick="submitProject()">Create Project</button>
    <div id="loadingBarContainer"><div id="loadingBar"></div></div>
    <div id="errorMessage"></div>

    <div id="projectsContainer"></div>

    <iframe id="playerFrame" width="480" height="360"></iframe>

    <script>
        const VARIABLE_NAME = "☁ Projects";
        const PROJECT_ID = "1134768903";
        const cloudSocket = new WebSocket("wss://clouddata.turbowarp.org/");
        let currentProjects = [];

        cloudSocket.onopen = () => {
            cloudSocket.send(JSON.stringify({ m: "sub", project_id: PROJECT_ID }));
        };

        cloudSocket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.name === VARIABLE_NAME) {
                const decodedJson = cloudValueToString(data.value);
                try {
                    currentProjects = JSON.parse(decodedJson) || [];
                    renderProjects();
                } catch (e) {
                    console.error("Failed to parse cloud data:", e);
                    currentProjects = [];
                }
            }
        };

        function submitProject() {
            const urlInput = document.getElementById("projectUrl");
            const url = urlInput.value.trim();
            const match = url.match(/^https:\/\/turbowarp\.org\/(\d+)\/embed$/);

            if (!match) {
                document.getElementById("errorMessage").textContent = "Invalid URL. Must be like: https://turbowarp.org/PROJECT_ID/embed";
                return;
            }

            const projectId = match[1];

            // Start loading animation
            startLoadingBar();

            // Simulate loading time (2 seconds) before submission
            setTimeout(() => {
                if (!currentProjects.some(p => p.id === projectId)) {
                    currentProjects.push({ id: projectId });
                }

                const jsonString = JSON.stringify(currentProjects);
                const encodedValue = stringToCloudValue(jsonString);

                cloudSocket.send(JSON.stringify({
                    m: "set",
                    project_id: PROJECT_ID,
                    name: VARIABLE_NAME,
                    value: encodedValue
                }));

                urlInput.value = "";
                document.getElementById("errorMessage").textContent = "";
            }, 2000); // Simulated 2 seconds loading

        }

        function renderProjects() {
            const container = document.getElementById("projectsContainer");
            container.innerHTML = "";

            currentProjects.forEach((project) => {
                const card = document.createElement("div");
                card.className = "project-card";

                const thumbnail = document.createElement("div");
                thumbnail.className = "project-thumbnail";
                thumbnail.style.backgroundImage = `url(https://uploads.scratch.mit.edu/get_image/project/${project.id}_480x360.png)`;

                const playButton = document.createElement("div");
                playButton.className = "play-button";
                playButton.textContent = "Play";
                playButton.onclick = () => playProject(project.id);

                card.appendChild(thumbnail);
                card.appendChild(playButton);
                container.appendChild(card);
            });

            // Stop the loading animation after rendering
            stopLoadingBar();
        }

        function playProject(projectId) {
            const playerFrame = document.getElementById("playerFrame");
            playerFrame.src = `https://turbowarp.org/${projectId}/embed`;
            playerFrame.style.display = "block";
        }

        function stringToCloudValue(str) {
            return Array.from(str).map(char => char.charCodeAt(0)).join(" ");
        }

        function cloudValueToString(value) {
            return value.split(" ").map(num => String.fromCharCode(Number(num))).join("");
        }

        function startLoadingBar() {
            const container = document.getElementById("loadingBarContainer");
            const bar = document.getElementById("loadingBar");
            container.style.display = "block";
            bar.style.width = "0%";

            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                bar.style.width = progress + "%";
                if (progress >= 100) clearInterval(interval);
            }, 200);
        }

        function stopLoadingBar() {
            document.getElementById("loadingBarContainer").style.display = "none";
        }
    </script>
</body>

</html>
